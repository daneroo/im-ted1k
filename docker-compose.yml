# ted1k Docker image shared by all containers (php,python,shell scripts)

teddb:
  image: mysql
  restart: unless-stopped
  ports:
    - "3306:3306"

  volumes:
    - ./data/mysql:/var/lib/mysql
    # if we wanted it on another disk
    # - /data/ted/data:/var/lib/mysql

  environment:
    MYSQL_DATABASE: ted
    MYSQL_ALLOW_EMPTY_PASSWORD: 'yes'
    # MYSQL_ROOT_PASSWORD:
    # MYSQL_USER:
    # MYSQL_PASSWORD:

capture:
  build: .
  restart: unless-stopped
  command: python capture.py --forever --device /hostdev/ttyUSB0
  # command: bash -c 'while true; do echo `date`|tee -a /data/coco.txt; sleep 1; done'
  links:
    - teddb
  volumes:
    # not used yet : /data/jsonl
    - ./data:/data
    - /dev:/hostdev
  privileged: true

summarize:
  build: .
  restart: unless-stopped
  command: python summarize.py --days 1 --forever
  links:
    - teddb

monitor:
  build: .
  restart: unless-stopped
  command: ./monitor.sh
  links:
    - teddb

publish:
  build: .
  restart: unless-stopped
  command: ./publish.sh
  links:
    - teddb
  